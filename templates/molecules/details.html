<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://3Dmol.csb.pitt.edu/build/3Dmol-min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<style>

    .label_text {
        background-color:#dce8e6;
        width:40%;
    }

    .value_text {
        background-color:#ceddd9;
        max-width: 300px;
    }

    .mol-container {
        width: 100%;
        height: 400px;
        position: relative;
    }

    .container-fluid {
        padding: 60px 50px;
    }
    #inchi {
        max-width: 300px;
        max-height: 300px;
    }
    #smile {
        max-width: 300px;
        max-height: 300px;
    }

    #link {
        max-width:300px;
        word-wrap:break-word;
    }

</style>
<body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">PDBrt</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="{% url 'molecules:index' %}">Home</a></li>
                <li><a href="#">Details</a></li>
                <li><a href="{% url 'molecules:sources' %}">Database</a></li>
                {% if user.is_authenticated%}
                    <li><a href="{% url 'molecules:add_form' %}">Add</a></li>
                {% endif %}
            </ul>

            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated %}
                    <li><a href="{% url 'molecules:logout' %}"><span class="glyphicon glyphicon-off"></span> Logout {{user.username}}</a></li>
                {% else %}
                    <li><a href="{% url 'molecules:signup' %}"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                    <li><a href="{% url 'molecules:login' %}"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                {% endif %}
            </ul>

        </div>
    </nav>
    <!--
    <div class="jumbotron text-center">
        <h1>PDBrt</h1>
        <form class="form-inline">
            <div class="input-group">
                <input type="search" class="form-control" size="30" placeholder="PDB ID" required>
                <div class=input-group-button">
                    <button type="button" class="btn btn-danger">Search</button>
                </div>
            </div>
        </form>
    </div>
    -->
    <div class="jumbotron">
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-4 col-lg-offset-2" style="background-color:#f1f1f1">
                <div id="container-01" class="mol-container"></div>
                <div id="view_modyficators">
                    
                    modyfikatory widoku<br>
                    <input type="button" value="Stick" onclick="viewer.setStyle({},{stick:{}}); viewer.render();">
                    <input type="button" value="Line" onclick="viewer.setStyle({},{line:{}}); viewer.render();">
                    <input type="button" value="Cross" onclick="viewer.setStyle({},{cross:{linewidth:2}}); viewer.render();">
                    <input type="button" value="Sphere" onclick="viewer.setStyle({},{sphere:{}}); viewer.render();">
                    <input type="button" value="Cartoon" onclick="viewer.setStyle({hetflag:false},{cartoon:{color: 'spectrum'}}); viewer.render();">
                    <input type="button" value="Label alpha C's" onclick="addLabels(viewer); viewer.render();">

                </div>
            </div>
            <div class="col-lg-4" style="background-color:#f1f1f1; box-shadow:0 2px 4px 0">
                <table class="table" style="width:80%" align="left">
                    <tr><td colspan="2"><b>Entrance information</b></td></tr>
                    <tr>
                        <td>PDB ID:</td>
                        <td>{{ protein.pdb_id }}</td>
                    </tr>
                    <tr>
                        <td class="label_text">Complex Type:</td>
                        <td class="value_text">{{protein.complex_type }}</td>
                    </tr>
                    <tr>
                        <td>Protein Name:</td>
                        <td>{{protein.protein_name }}</td>
                    </tr>
                    <tr>
                        <td class="label_text">Ligand Name:</td>
                        <td class="value_text">{{protein.ligand_name }}</td>
                    </tr>
                    <tr>
                        <td>EC.Number:</td>
                        <td>{{protein.ec_number }}</td>
                    </tr>
                    <tr>
                        <td class="label_text">Resolution:</td>
                        <td class="value_text">{{protein.resolution}}(&#197)</td>
                    </tr>
                    <tr>
                        <td>Residence time:</td>
                        {% if protein.residence_time > 0.0 %}
                            {% if protein.residence_time_minus > 0.0 %}
                                <td>{{protein.residence_time.normalize }} &#177
                                    {{protein.residence_time_plus_minus.normalize}} [min]</td>
                            {% else %}
                                <td>{{protein.residence_time.normalize}}</td>
                            {% endif %}
                        {% else %}
                            <td>-</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td class="label_text">Primary reference:</td>
                        <td class="value_text" id="link"><a href="{{protein.primary_reference}}">{{protein.primary_reference}}</a></td>
                    </tr>
                </table>
                <table class="table" style="width:80%", align="left">
                    <tr><td colspan="2"><b>Additional parameters</b></td></tr>
                    <tr>
                        <td class="label_text">K<sub>i</sub>:</td>
                        {% if protein.ki_value > 0.0 %}
                            {% if protein.ki_plus_minus > 0.0 %}
                                <td class="value_text">{{protein.ki_value.normalize }} &#177
                                    {{protein.ki_plus_minus.normalize}}</td>
                            {% else %}
                                <td class="value_text">{{protein.ki_value.normalize }}</td>
                            {% endif %}
                        {% else %}
                            <td class="value_text">-</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td>K<sub>on</sub>:</td>
                        {% if protein.kon_value != 0.0 %}
                            <td>{{protein.kon_value }} &times 10<sup>{{protein.kon_ten_to_power}}</sup></td>
                        {% else %}
                            <td>-</td>
                        {% endif %}
                    </tr>
                    <tr>
                        <td class="label_text">K<sub>off</sub>:</td>
                        {% if protein.koff_value > 0.0 %}
                            {% if protein.koff_plus_minus > 0.0 %}
                                <td class="value_text">{{protein.koff_value.normalize }} &#177
                                    {{protein.koff_plus_minus.normalize}}</td>
                            {% else %}
                                <td class="value_text">{{protein.koff_value.normalize }}</td>
                            {% endif %}
                        {% else %}
                            <td class="value_text">-</td>
                        {% endif %}
                    </tr>
                </table>
            </div>
        </div>
    </div>


</body>
</html>

<script>
$(document).ready(function() {
  let element = $('#container-01');
  let config = { backgroundColor: 'black' };
  let viewer = $3Dmol.createViewer( element, config );
  viewer = $3Dmol.createViewer("container-01", {defaultcolors : $3Dmol.rasmolElementColors });
  viewer.setBackgroundColor(0x000000);
  var pdbUri = '/media/pdb/{{ protein.pdb_id }}.pdb';

  jQuery.ajax( pdbUri, {
    success: function(data) {
      let v = viewer;
      v.addModel( data, "pdb" );                       /* load data */
      v.setStyle({}, {cartoon: {color: 'spectrum'}});  /* style all atoms */
      v.zoomTo();                                      /* set camera */
      v.render();                                      /* render scene */
      /*v.zoom(1.2, 1000);*/                               /* slight zoom */
    },
    error: function(hdr, status, err) {
      console.error( "Failed to load PDB " + pdbUri + ": " + err );
    },
  });
});

</script>
